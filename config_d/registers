# Register interface definition

# This special register block is not present in the config file and contains
# fixed register definitions used in the hardware interface.
#   Alas, because hardware access occurs during the processing of this file, it
# is necessary to place this section at the start!
*REG        31
    # Bit bus readout registers: first write to BIT_READ_RST to capture a
    # snapshot of the bit bus and its changes, then read BIT_READ_VALUE 8 times
    # to read out bit bus values and change flags.
    BIT_READ_RST            0
    BIT_READ_VALUE          1

    # Position bus readout registers: first write to POS_READ_RST to snapshot
    # the position bus and the change set, then read POS_READ_VALUE 32 times to
    # read out the positions, and finally read the change set from
    # POS_READ_CHANGES.
    POS_READ_RST            2
    POS_READ_VALUE          3
    POS_READ_CHANGES        4

    # The capture set is written by first writing to PCAP_START_WRITE and then
    # writing the required changes to PCAP_WRITE
    PCAP_START_WRITE        5
    PCAP_WRITE              6
    # Framing capture for each position is controlled by writing to
    # PCAP_FRAMING_MASK.  If framing capture is required then
    # PCAP_FRAMING_ENABLE must also be set separately.
    PCAP_FRAMING_MASK       7
    PCAP_FRAMING_ENABLE     10
    PCAP_FRAMING_MODE       11

    # Position capture control
    PCAP_ARM                8
    PCAP_DISARM             9

    # Slow read and write status: if 1 transaction in progress, if 0 transaction
    # complete.
    SLOW_REGISTER_STATUS    12


# These registers are used by the kernel driver to read the data capture stream.
# This block is not used by the server, but is here for documentation and other
# automated tools.
*DRV        25
    # The physical address of each DMA block is written to this register.
    PCAP_DMAADDR            0
    # This register configures the maximum interval between capture interrupts
    PCAP_TIMEOUT            1
    # Interrupt status and acknowledge
    PCAP_IRQ_STATUS         2
    # ? Should this be merged into IRQ status for a single read?
    PCAP_SMPL_COUNT         3
    # DMA block size in bytes
    PCAP_BLOCK_SIZE         4

TTLIN       18
    TERM            0
    VAL             2 3 4 5 6 7

TTLOUT      0
    VAL             0

LVDSIN      17
    VAL             8 9

LVDSOUT     1
    VAL             0

LUT         2
    FUNC            5
    INPA            0
    INPB            1
    INPC            2
    INPD            3
    INPE            4
    VAL             10 11 12 13 14 15 16 17

SRGATE      3
    SET_EDGE        2
    RST_EDGE        3
    FORCE_SET       4
    FORCE_RST       5
    SET             0
    RST             1
    VAL             18 19 20 21

DIV         4
    DIVISOR         2
    FIRST_PULSE     3
    FORCE_RST       5
    INP             0
    RST             1
    OUTD            22 23 24 25
    OUTN            26 27 28 29
    COUNT           4

PULSE       5
    DELAY           3 2     >3
    WIDTH           5 4     >3
    FORCE_RST       6
    INP             0
    RST             1
    OUT             30 31 32 33
    PERR            34 35 36 37
    ERR_OVERFLOW    7
    ERR_PERIOD      8
    QUEUE           9
    MISSED_CNT      10

SEQ         6
    PRESCALE        5
    SOFT_GATE       6
    TABLE_CYCLE     8
    GATE            0
    INPA            1
    INPB            2
    INPC            3
    INPD            4
    OUTA            38 39 40 41
    OUTB            42 43 44 45
    OUTC            46 47 48 49
    OUTD            50 51 52 53
    OUTE            54 55 56 57
    OUTF            58 59 60 61
    ACTIVE          62 63 64 65
    CUR_FRAME       9
    CUR_FCYCLE      10
    CUR_TCYCLE      11
    TABLE_STROBES   12
    TABLE           short   512    13 14 15

INENC       7
    PROTOCOL        slow 0
    CLKRATE         1
    FRAMERATE       2
    BITS            3
    SETP            4
    RST_ON_Z        5
    EXTENSION       6
    A               66 67 68 69
    B               70 71 72 73
    Z               74 75 76 77
    CONN            78 79 80 81
    POSN            1 2 3 4 / 33 34 35 36

QDEC        8
    RST_ON_Z        3
    SETP            4
    A               0
    B               1
    Z               2
    POSN            5 6 7 8

OUTENC      9
    PROTOCOL        5
    BITS            6
    QPRESCALAR      7
    FORCE_QSTATE    8
    A               0
    B               1
    Z               2
    POSN            4
    CONN            3
    QSTATE          9

POSENC      10
    POSN            0
    QPRESCALAR      1
    MODE            2
    FORCE_QSTATE    3
    A               82 83 84 85
    B               86 87 88 89
    QSTATE          4

# Hard wired inputs!
ADDER       12
    MASK            1
    OUTSCALE        2
    RESULT          11

COUNTER     13
    DIR             2
    START           3
    STEP            4
    ENABLE          0
    TRIGGER         1
    CARRY           90 91 92 93 94 95 96 97
    COUNT           12 13 14 15 16 17 18 19

PGEN        14
    SAMPLES         2
    CYCLES          3
    ENABLE          0
    TRIGGER         1
    POSN            20 21
    TABLE           long    2^20    4 5

PCOMP       15
    START           2
    STEP            3
    WIDTH           4
    PNUM            5
    RELATIVE        6
    DIR             7
    FLTR_DELTAT     8
    FLTR_THOLD      9
    LUT_ENABLE      10
    ENABLE          0
    POSN            1
    ACT             98 99 100 101
    PULSE           102 103 104 105
    FLTR_DIR        13
    ERROR           14
    TABLE           long    2^10    11 12

ADC         26
    TRIGGER         0
    RST             1
    DATA            22 23 24 25 26 27 28 29 / 54 55 56 57 58 59 60 61

PCAP        16
    ENABLE          0
    FRAME           1
    CAPTURE         2
    MISSED_CAPTURES 3
    ERR_STATUS      4
    ACTIVE          106
    CAPTURE_TS      62 63
    FRAME_LENGTH    37
    CAPTURE_OFFSET  38
    ADC_COUNT       32
    BITA            39
    BITB            40
    BITC            41
    BITD            42

BITS        28
    A_SET           0
    B_SET           1
    C_SET           2
    D_SET           3
    A               118
    B               119
    C               120
    D               121
    ZERO            0
    ONE             1

CLOCKS      29
    A_PERIOD        0
    B_PERIOD        1
    C_PERIOD        2
    D_PERIOD        3
    A               122
    B               123
    C               124
    D               125

POSITIONS   30
    ZERO            0

SLOW        27
    INENC_CTRL      0
    OUTENC_CTRL     1

