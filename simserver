#!/bin/sh

HERE="$(dirname "$0")"

CONFIG_DB="$HERE"/config/config
REGISTER_DB="$HERE"/config/registers
DESCRIPTION_DB="$HERE"/config/description

CONFIG_PORT=8888
DATA_PORT=8889

# Run the simulation server as a daemon.  It will ensure its socket is up and
# running before taking itself into the background.
"$HERE"/simulation/sim_server.py -d

exec valgrind --leak-check=full --track-origins=yes \
    "$HERE"/build/sim_server/server \
    -p$CONFIG_PORT -d$DATA_PORT -R \
    -c"$CONFIG_DB" -r"$REGISTER_DB" -D"$DESCRIPTION_DB"
